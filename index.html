<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayBoss – Kalkulator & Manajemen Stok</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<!-- ======================================================
   NAVBAR
====================================================== -->
<div class="w-full bg-white shadow mb-6">
  <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
    <h2 class="text-lg font-semibold">PayBoss Inventory System</h2>
    <div class="flex gap-3">
      <button id="nav-calc" class="px-3 py-1.5 rounded-lg bg-amber-500 text-white text-sm">Kalkulator</button>
      <button id="nav-stock" class="px-3 py-1.5 rounded-lg bg-gray-200 text-sm">Manajemen Stok</button>
    </div>
  </div>
</div>

<!-- ======================================================
    PAGE 1 – KALKULATOR PENJUALAN
====================================================== -->
<div id="page-calc" class="max-w-7xl mx-auto px-4">

  <h1 class="text-3xl font-bold text-gray-800 mb-4">
    Kalkulator Stok Bahan Minuman
  </h1>

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

    <!-- ==============================
         INPUT PENJUALAN
    =============================== -->
    <div class="bg-white p-5 rounded-2xl shadow">

      <h2 class="text-xl font-bold mb-3">Input Penjualan Harian</h2>

      <!-- KATEGORI -->
      <div class="space-y-6 max-h-[600px] overflow-y-auto pr-2">

        <!-- ================= HOT COFFEE ================= -->
        <div>
          <h3 class="font-semibold text-lg mb-2">Hot Coffee</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>Cappucino <input class="qty-input" data-menu="Cappucino" type="number"></div>
            <div>Caffe latte <input class="qty-input" data-menu="Caffe latte" type="number"></div>
            <div>Split <input class="qty-input" data-menu="Split" type="number"></div>
            <div>Magic <input class="qty-input" data-menu="Magic" type="number"></div>
          </div>
        </div>

        <!-- ================= NON COFFEE ================= -->
        <div>
          <h3 class="font-semibold text-lg mb-2">Non Coffee</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>Matcha <input class="qty-input" data-menu="Matcha" type="number"></div>
            <div>Red Velvet <input class="qty-input" data-menu="Red Velvet" type="number"></div>
            <div>Taro <input class="qty-input" data-menu="Taro" type="number"></div>
            <div>Coklat <input class="qty-input" data-menu="Coklat" type="number"></div>
            <div>Cookies and cream <input class="qty-input" data-menu="Cookies and cream" type="number"></div>
            <div>Lemon Tea <input class="qty-input" data-menu="Lemon Tea" type="number"></div>
          </div>
        </div>

        <!-- ================= MOCKTAIL ================= -->
        <div>
          <h3 class="font-semibold text-lg mb-2">Mocktail</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>Kiwi kiss <input class="qty-input" data-menu="Kiwi kiss" type="number"></div>
            <div>Summer Glow <input class="qty-input" data-menu="Summer Glow" type="number"></div>
            <div>Ocean blue <input class="qty-input" data-menu="Ocean blue" type="number"></div>
            <div>Flora pop <input class="qty-input" data-menu="Flora pop" type="number"></div>
            <div>Lembayung senja <input class="qty-input" data-menu="Lembayung senja" type="number"></div>
            <div>Midnight bloom <input class="qty-input" data-menu="Midnight bloom" type="number"></div>
            <div>Dark moon <input class="qty-input" data-menu="Dark moon" type="number"></div>
            <div>Tropical zing <input class="qty-input" data-menu="Tropical zing" type="number"></div>
            <div>Honey smooth <input class="qty-input" data-menu="Honey smooth" type="number"></div>
          </div>
        </div>

        <!-- ================= KOPI SUSU ================= -->
        <div>
          <h3 class="font-semibold text-lg mb-2">Kopi Susu</h3>
          <div class="grid grid-cols-2 gap-3">
            <div>Clasic Almond <input class="qty-input" data-menu="Clasic Almond" type="number"></div>
            <div>Banana <input class="qty-input" data-menu="Banana" type="number"></div>
            <div>Caramel <input class="qty-input" data-menu="Caramel" type="number"></div>
            <div>Vanilla <input class="qty-input" data-menu="Vanilla" type="number"></div>
            <div>Brown sugar <input class="qty-input" data-menu="Brown sugar" type="number"></div>
            <div>Butterscott <input class="qty-input" data-menu="Butterscott" type="number"></div>
            <div>Kopi matcha <input class="qty-input" data-menu="Kopi matcha" type="number"></div>
            <div>Spanish Latte <input class="qty-input" data-menu="Spanish Latte" type="number"></div>
          </div>
        </div>

      </div>

      <button id="btn-calc" class="mt-4 px-4 py-2 bg-amber-600 text-white rounded-lg w-full">
        Hitung Kebutuhan Bahan
      </button>

    </div>

    <!-- ==============================
         OUTPUT HASIL
    =============================== -->
    <div id="calc-result" class="bg-white p-5 rounded-2xl shadow hidden">

      <h2 class="text-xl font-bold mb-3">Hasil Kebutuhan Bahan</h2>
      <div id="calc-table"></div>

      <button id="btn-update-stock" class="mt-4 px-4 py-2 bg-green-600 text-white rounded-lg w-full">
        Kurangi Stok
      </button>
    </div>

  </div>
</div>

<!-- ======================================================
    PAGE 2 – MANAJEMEN STOK
====================================================== -->
<div id="page-stock" class="hidden max-w-6xl mx-auto px-4">

  <h2 class="text-2xl font-bold mb-4">Manajemen Stok</h2>

  <table class="w-full text-sm bg-white rounded-xl shadow overflow-hidden">
    <thead class="bg-gray-100 font-semibold">
      <tr>
        <th class="border px-3 py-2">Nama Bahan</th>
        <th class="border px-3 py-2">Current</th>
        <th class="border px-3 py-2">Safe</th>
        <th class="border px-3 py-2">Unit</th>
        <th class="border px-3 py-2">Aksi</th>
      </tr>
    </thead>
    <tbody id="stock-table-body"></tbody>
  </table>

  <button id="btn-add-stock" class="mt-5 px-4 py-2 bg-blue-600 text-white rounded-lg">
    + Tambah Stok Baru
  </button>

  <!-- FORM EDIT / ADD -->
  <div id="stock-form" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white p-5 rounded-xl w-96 shadow-xl">

      <h3 id="form-title" class="text-xl font-bold mb-3">Tambah Stok</h3>

      <input id="form-name" placeholder="Nama bahan" class="w-full p-2 border rounded mb-2">
      <input id="form-current" type="number" placeholder="Current" class="w-full p-2 border rounded mb-2">
      <input id="form-safe" type="number" placeholder="Safe" class="w-full p-2 border rounded mb-2">
      <input id="form-unit" placeholder="Unit" class="w-full p-2 border rounded mb-2">

      <div class="flex justify-end gap-2">
        <button id="form-cancel" class="px-4 py-2 bg-gray-300 rounded">Batal</button>
        <button id="form-save" class="px-4 py-2 bg-green-600 text-white rounded">Simpan</button>
      </div>

    </div>
  </div>

</div>

<!-- ======================================================
   SCRIPT
====================================================== -->
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxGY-EiVFQf-QtcWKnQO_g-iy8objzfEts5DNBaWlofnvQV7UiIcGQTnu8p6ZW-eOs/exec";

let stock = {};   
let sales = {};   

function normalize(name) {
  return name.toLowerCase().trim().replace(/\s+/g, "");
}

/* ======================================================
   LOAD STOK DARI GOOGLE SHEET
====================================================== */
async function loadStock() {
  const res = await fetch(SCRIPT_URL + "?action=getStock");
  const data = await res.json();
  stock = data.stock || {};
  renderStockTable();
}
loadStock();

/* ======================================================
   HITUNG PENJUALAN
====================================================== */
document.querySelectorAll(".qty-input").forEach(input => {
  input.addEventListener("input", () => {
    const menu = input.dataset.menu;
    sales[menu] = parseInt(input.value) || 0;
  });
});

document.getElementById("btn-calc").onclick = () => {
  const output = [];
  Object.entries(sales).forEach(([menu, qty]) => {
    if (qty > 0) {
      output.push(`<div class='border p-2 rounded bg-gray-50 mb-2'>${menu}: <b>${qty}</b></div>`);
    }
  });

  document.getElementById("calc-table").innerHTML = output.join("");
  document.getElementById("calc-result").classList.remove("hidden");
};

/* ======================================================
   UPDATE STOK
====================================================== */
document.getElementById("btn-update-stock").onclick = async () => {
  for (let key in stock) {
    stock[key].current -= 10; // contoh
  }

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ action: "saveUsage", stock }),
  });

  alert("Stok berhasil di-update!");
  loadStock();
};

/* ======================================================
   NAVIGATION
====================================================== */
const pageCalc = document.getElementById("page-calc");
const pageStock = document.getElementById("page-stock");

document.getElementById("nav-calc").onclick = () => {
  pageCalc.classList.remove("hidden");
  pageStock.classList.add("hidden");
};

document.getElementById("nav-stock").onclick = () => {
  pageCalc.classList.add("hidden");
  pageStock.classList.remove("hidden");
};

/* ======================================================
   STOCK TABLE
====================================================== */
function renderStockTable() {
  const tbody = document.getElementById("stock-table-body");
  tbody.innerHTML = "";

  Object.entries(stock).forEach(([key, s]) => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="border px-2 py-1">${key}</td>
      <td class="border px-2 py-1">${s.current}</td>
      <td class="border px-2 py-1">${s.safe}</td>
      <td class="border px-2 py-1">${s.unit}</td>
      <td class="border px-2 py-1">
        <button class="btn-edit bg-blue-500 text-white px-2 py-1 rounded" data-key="${key}">
          Edit
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  document.querySelectorAll(".btn-edit").forEach(btn => {
    btn.onclick = () => openStockForm(btn.dataset.key);
  });
}

/* ======================================================
   FORM EDIT / ADD
====================================================== */
function openStockForm(key) {
  const form = document.getElementById("stock-form");
  form.classList.remove("hidden");

  if (key) {
    document.getElementById("form-title").innerText = "Edit Stok";
    document.getElementById("form-name").value = key;
    document.getElementById("form-current").value = stock[key].current;
    document.getElementById("form-safe").value = stock[key].safe;
    document.getElementById("form-unit").value = stock[key].unit;
  } else {
    document.getElementById("form-title").innerText = "Tambah Stok Baru";
    document.getElementById("form-name").value = "";
    document.getElementById("form-current").value = "";
    document.getElementById("form-safe").value = "";
    document.getElementById("form-unit").value = "";
  }

  document.getElementById("form-save").onclick = saveStock;
}

document.getElementById("form-cancel").onclick = () => {
  document.getElementById("stock-form").classList.add("hidden");
};

/* ======================================================
   SIMPAN PERUBAHAN STOK
====================================================== */
async function saveStock() {
  const name = normalize(document.getElementById("form-name").value);
  const current = parseFloat(document.getElementById("form-current").value);
  const safe = parseFloat(document.getElementById("form-safe").value);
  const unit = document.getElementById("form-unit").value;

  stock[name] = { current, safe, unit };

  await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ action: "saveUsage", stock })
  });

  alert("Stok disimpan!");
  document.getElementById("stock-form").classList.add("hidden");
  loadStock();
}

</script>

</body>
</html>
